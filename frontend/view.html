<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Interactive dashboard with analytics and reporting">
  <title>Enhanced Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#3B82F6',
              600: '#2563EB'
            },
            success: {
              500: '#10B981',
              600: '#059669'
            },
            warning: {
              500: '#F59E0B',
              600: '#D97706'
            },
            danger: {
              500: '#EF4444',
              600: '#DC2626'
            }
          }
        }
      }
    }
  </script>
</head>
<div class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
<div class="flex flex-col md:flex-row h-screen overflow-hidden">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-button" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-md bg-white dark:bg-gray-800 shadow-md">
      <i data-lucide="menu" class="w-5 h-5"></i>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 p-4 space-y-6 shadow-md transform -translate-x-full md:translate-x-0 fixed md:static inset-y-0 z-40 transition-transform duration-200">
      <div class="text-xl font-bold flex items-center space-x-2">
        <i data-lucide="menu" class="w-5 h-5"></i><span>Menu</span>
      </div>
      <ul class="space-y-4">
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
          <a href="dashboard.html" class="w-full py-2">Dashboard</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
          <a href="analytics.html" class="w-full py-2">Analytics</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="car" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Vehicles</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="user" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Drivers</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="wrench" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Reparation</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="droplet" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Fuel</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="settings" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Maintenance</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-500">
          <i data-lucide="route" class="w-5 h-5"></i>
          <a href="#" class="w-full py-2">Trip</a>
        </li>
      </ul>
    </aside>
    
    <!-- Main content -->
    <main class="flex-1 overflow-auto p-6 pt-16 md:pt-6">
      <!-- Loading overlay -->
      <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl flex flex-col items-center">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500 mb-4"></div>
          <p class="text-lg font-medium">Loading...</p>
        </div>
      </div>

      <!-- Status Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow text-center transition-transform hover:scale-105">
          <h3 class="text-lg font-semibold">Sales</h3>
          <div class="text-2xl font-bold">$12,300</div>
          <div class="w-16 h-16 mx-auto mt-2 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center transition-colors">
            <span class="text-blue-600 dark:text-blue-300">+15%</span>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow text-center transition-transform hover:scale-105">
          <h3 class="text-lg font-semibold">Income</h3>
          <div class="text-2xl font-bold">$8,900</div>
          <div class="w-16 h-16 mx-auto mt-2 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center transition-colors">
            <span class="text-green-600 dark:text-green-300">+10%</span>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow text-center transition-transform hover:scale-105">
          <h3 class="text-lg font-semibold">Expenses</h3>
          <div class="text-2xl font-bold">$5,400</div>
          <div class="w-16 h-16 mx-auto mt-2 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center transition-colors">
            <span class="text-red-600 dark:text-red-300">-5%</span>
          </div>
        </div>
      </div>

      <!-- Reports Section -->
      <section id="reports" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-3 gap-2">
          <button id="add-report-btn" class="bg-primary-600 text-white px-4 py-1.5 rounded hover:bg-primary-700 text-sm font-semibold transition-colors flex items-center gap-1">
            <i data-lucide="plus" class="w-4 h-4"></i> Add
          </button>
          <div class="flex flex-wrap gap-2 items-center">
            <label for="fromDate" class="text-sm sr-only">From date:</label>
            <div class="relative">
              <i data-lucide="calendar" class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"></i>
              <input type="date" id="fromDate" class="border rounded px-2 py-1 text-sm text-black dark:text-white dark:bg-gray-700 pl-8" aria-label="From date">
            </div>
            <label for="toDate" class="text-sm sr-only">To date:</label>
            <div class="relative">
              <i data-lucide="calendar" class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"></i>
              <input type="date" id="toDate" class="border rounded px-2 py-1 text-sm text-black dark:text-white dark:bg-gray-700 pl-8" aria-label="To date">
            </div>
            <div class="relative">
              <i data-lucide="search" class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"></i>
              <input type="text" id="searchInput" placeholder="Search..." class="border rounded px-2 py-1 text-sm text-black dark:text-white dark:bg-gray-700 pl-8" aria-label="Search reports">
            </div>
            <button onclick="exportExcel()" class="bg-success-500 text-white px-3 py-1 rounded hover:bg-success-600 transition-colors flex items-center gap-1">
              <i data-lucide="file-text" class="w-4 h-4"></i> Excel
            </button>
            <button onclick="exportPDF()" class="bg-danger-500 text-white px-3 py-1 rounded hover:bg-danger-600 transition-colors flex items-center gap-1">
              <i data-lucide="file-text" class="w-4 h-4"></i> PDF
            </button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table id="reportTable" class="w-full text-left text-sm">
            <thead>
              <tr class="border-b dark:border-gray-700">
                <th class="py-2 px-2">Date</th>
                <th class="py-2 px-2">Item</th>
                <th class="py-2 px-2">Amount</th>
                <th class="py-2 px-2">Status</th>
                <th class="py-2 px-2">Actions</th>
              </tr>
            </thead>
            <tbody id="reportBody" class="divide-y dark:divide-gray-700"></tbody>
          </table>
        </div>
        <div class="mt-4 flex justify-between items-center">
          <div class="text-sm text-gray-500 dark:text-gray-400" id="table-info"></div>
          <div class="flex space-x-2" id="pagination"></div>
        </div>
      </section>

      <!-- Add Report Modal -->
      <div id="add-report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-md">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">Add New Report</h3>
            <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
              <i data-lucide="x" class="w-5 h-5"></i>
            </button>
          </div>
          <form id="report-form" class="space-y-4">
            <div>
              <label for="report-date" class="block text-sm font-medium mb-1">Date</label>
              <input type="date" id="report-date" required class="w-full border rounded px-3 py-2 text-sm text-black dark:text-white dark:bg-gray-700">
            </div>
            <div>
              <label for="report-item" class="block text-sm font-medium mb-1">Item</label>
              <input type="text" id="report-item" required class="w-full border rounded px-3 py-2 text-sm text-black dark:text-white dark:bg-gray-700">
            </div>
            <div>
              <label for="report-amount" class="block text-sm font-medium mb-1">Amount</label>
              <input type="number" id="report-amount" required class="w-full border rounded px-3 py-2 text-sm text-black dark:text-white dark:bg-gray-700">
            </div>
            <div>
              <label for="report-status" class="block text-sm font-medium mb-1">Status</label>
              <select id="report-status" required class="w-full border rounded px-3 py-2 text-sm text-black dark:text-white dark:bg-gray-700">
                <option value="Completed">Completed</option>
                <option value="Pending">Pending</option>
                <option value="Failed">Failed</option>
              </select>
            </div>
            <div class="flex justify-end space-x-3 pt-2">
              <button type="button" id="cancel-report" class="px-4 py-2 text-sm font-medium rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm font-medium rounded bg-primary-600 text-white hover:bg-primary-700 transition-colors">
                Save Report
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- Right Sidebar -->
    <aside class="w-1/5 bg-white dark:bg-gray-800 p-4 space-y-6 shadow-md hidden lg:block">
      <div class="flex justify-between items-center">
        <button id="theme-toggle" class="text-xl p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" aria-label="Toggle dark mode">
          <i data-lucide="moon" class="w-5 h-5 hidden dark:block"></i>
          <i data-lucide="sun" class="w-5 h-5 dark:hidden"></i>
        </button>
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-300 font-medium">
            JD
          </div>
          <div>
            <div class="text-sm font-semibold">John Doe</div>
            <div class="text-xs text-gray-500 dark:text-gray-300">Admin</div>
          </div>
        </div>
      </div>

      <!-- Recent Updates -->
      <div>
        <h4 class="font-bold mb-4 text-lg">Recent Updates</h4>
        <div class="flex flex-col space-y-6 relative">
          <div class="absolute left-5 top-0 bottom-0 w-0.5 bg-blue-500"></div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">Order delivered</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">5 minutes ago</p>
            </div>
          </div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">New user signed up</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">15 minutes ago</p>
            </div>
          </div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">Inventory updated</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">1 hour ago</p>
            </div>
          </div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">Backup completed</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">2 hours ago</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Analytics -->
      <div class="mt-8">
        <h4 class="font-bold mb-4 text-lg">Sales Analytics</h4>
        <div class="flex flex-col space-y-6 relative">
          <div class="absolute left-5 top-0 bottom-0 w-0.5 bg-green-500"></div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-green-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">Sales dropped by 12%</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">in the last 2 weeks</p>
            </div>
          </div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-green-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">Profit increased by 7%</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">in the last 4 days</p>
            </div>
          </div>

          <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-green-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
              <p class="font-medium">New revenue stream added</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">3 days ago</p>
            </div>
          </div>
        </div>
      </div>
    </aside>
</div>

<!-- Add Lucide Icons CDN -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Scripts -->
<script>
  // Initialize Lucide icons
  lucide.createIcons();
  
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const sidebar = document.getElementById('sidebar');
  
  mobileMenuButton.addEventListener('click', () => {
    sidebar.classList.toggle('-translate-x-full');
    const icon = mobileMenuButton.querySelector('i');
    if (sidebar.classList.contains('-translate-x-full')) {
      icon.setAttribute('data-lucide', 'menu');
    } else {
      icon.setAttribute('data-lucide', 'x');
    }
    lucide.createIcons();
  });

  // Theme toggle
  const themeToggle = document.getElementById('theme-toggle');
  const html = document.documentElement;
  
  themeToggle.addEventListener('click', () => {
    html.classList.toggle('dark');
    localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
  });

  // Check for saved theme preference
  if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    html.classList.add('dark');
  } else {
    html.classList.remove('dark');
  }

  // Table data and functionality
  const rowsPerPage = 5;
  let currentPage = 1;
  let data = [
    { id: 1, date: '2025-05-01', item: 'Product A', amount: 500, status: 'Completed' },
    { id: 2, date: '2025-05-02', item: 'Product B', amount: 750, status: 'Pending' },
    { id: 3, date: '2025-05-03', item: 'Product C', amount: 300, status: 'Failed' },
    ...Array.from({ length: 17 }, (_, i) => ({
      id: i + 4,
      date: `2025-05-${(i + 4).toString().padStart(2, '0')}`,
      item: `Product ${String.fromCharCode(65 + (i % 5))}`,
      amount: Math.floor(400 + i * 10),
      status: ['Completed', 'Pending', 'Failed'][i % 3]
    }))
  ];

  // Status colors mapping
  const statusColors = {
    'Completed': 'text-success-500',
    'Pending': 'text-warning-500',
    'Failed': 'text-danger-500'
  };

  function showLoading(show) {
    document.getElementById('loading-overlay').classList.toggle('hidden', !show);
  }

  function formatCurrency(amount) {
    return '$' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
  }

  function renderTable() {
    showLoading(true);
    
    // Simulate API delay
    setTimeout(() => {
      const start = (currentPage - 1) * rowsPerPage;
      const searchText = document.getElementById("searchInput").value.toLowerCase();
      const fromDate = document.getElementById("fromDate").value;
      const toDate = document.getElementById("toDate").value;

      const filtered = data.filter(row => {
        const dateMatch = (!fromDate || row.date >= fromDate) && (!toDate || row.date <= toDate);
        const searchMatch = Object.values(row).some(val => 
          String(val).toLowerCase().includes(searchText)
        );
        return dateMatch && searchMatch;
      });

      const paginated = filtered.slice(start, start + rowsPerPage);
      const tbody = document.getElementById("reportBody");
      tbody.innerHTML = paginated.map(row => `
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          <td class="py-2 px-2">${row.date}</td>
          <td class="py-2 px-2">${row.item}</td>
          <td class="py-2 px-2">${formatCurrency(row.amount)}</td>
          <td class="py-2 px-2">
            <span class="${statusColors[row.status]} flex items-center">
              <i data-lucide="${row.status === 'Completed' ? 'check-circle' : row.status === 'Pending' ? 'clock' : 'x-circle'}" class="w-4 h-4 mr-1"></i>
              ${row.status}
            </span>
          </td>
          <td class="py-2 px-2 space-x-1">
            <button onclick="viewReport(${row.id})" class="text-primary-500 hover:text-primary-700 dark:hover:text-primary-400 p-1 rounded-full hover:bg-primary-50 dark:hover:bg-primary-900/50 transition-colors" aria-label="View">
              <i data-lucide="eye" class="w-4 h-4"></i>
            </button>
            <button onclick="editReport(${row.id})" class="text-warning-500 hover:text-warning-700 dark:hover:text-warning-400 p-1 rounded-full hover:bg-warning-50 dark:hover:bg-warning-900/50 transition-colors" aria-label="Edit">
              <i data-lucide="edit" class="w-4 h-4"></i>
            </button>
            <button onclick="confirmDelete(${row.id})" class="text-danger-500 hover:text-danger-700 dark:hover:text-danger-400 p-1 rounded-full hover:bg-danger-50 dark:hover:bg-danger-900/50 transition-colors" aria-label="Delete">
              <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
          </td>
        </tr>
      `).join('');

      const totalPages = Math.ceil(filtered.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      
      // Previous button
      let paginationHtml = `
        <button class="px-3 py-1 rounded border ${currentPage === 1 ? 'bg-gray-100 dark:bg-gray-700 cursor-not-allowed' : 'bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700'}" 
          ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
          <i data-lucide="chevron-left" class="w-4 h-4"></i>
        </button>
      `;
      
      // Page numbers
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      if (startPage > 1) {
        paginationHtml += `
          <button class="px-3 py-1 rounded ${1 === currentPage ? 'bg-primary-600 text-white' : 'bg-white dark:bg-gray-800 border hover:bg-gray-50 dark:hover:bg-gray-700'}" 
            onclick="changePage(1)">1</button>
          ${startPage > 2 ? '<span class="px-2 py-1">...</span>' : ''}
        `;
      }
      
      for (let i = startPage; i <= endPage; i++) {
        paginationHtml += `
          <button class="px-3 py-1 rounded ${i === currentPage ? 'bg-primary-600 text-white' : 'bg-white dark:bg-gray-800 border hover:bg-gray-50 dark:hover:bg-gray-700'}" 
            onclick="changePage(${i})">${i}</button>
        `;
      }
      
      if (endPage < totalPages) {
        paginationHtml += `
          ${endPage < totalPages - 1 ? '<span class="px-2 py-1">...</span>' : ''}
          <button class="px-3 py-1 rounded ${totalPages === currentPage ? 'bg-primary-600 text-white' : 'bg-white dark:bg-gray-800 border hover:bg-gray-50 dark:hover:bg-gray-700'}" 
            onclick="changePage(${totalPages})">${totalPages}</button>
        `;
      }
      
      // Next button
      paginationHtml += `
        <button class="px-3 py-1 rounded border ${currentPage === totalPages ? 'bg-gray-100 dark:bg-gray-700 cursor-not-allowed' : 'bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700'}" 
          ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
          <i data-lucide="chevron-right" class="w-4 h-4"></i>
        </button>
      `;
      
      pagination.innerHTML = paginationHtml;
      
      // Table info
      const tableInfo = document.getElementById("table-info");
      const startItem = filtered.length > 0 ? start + 1 : 0;
      const endItem = Math.min(start + rowsPerPage, filtered.length);
      tableInfo.textContent = `Showing ${startItem} to ${endItem} of ${filtered.length} entries`;
      
      // Refresh icons
      lucide.createIcons();
      showLoading(false);
    }, 500); // Simulated delay
  }

  function changePage(page) {
    currentPage = page;
    renderTable();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // Search and filter event listeners
  document.getElementById('searchInput').addEventListener('input', () => {
    currentPage = 1;
    renderTable();
  });

  document.getElementById('fromDate').addEventListener('change', () => {
    const toDate = document.getElementById('toDate');
    if (toDate.value && toDate.value < this.value) {
      toDate.value = this.value;
    }
    currentPage = 1;
    renderTable();
  });

  document.getElementById('toDate').addEventListener('change', () => {
    const fromDate = document.getElementById('fromDate');
    if (fromDate.value && fromDate.value > this.value) {
      fromDate.value = this.value;
    }
    currentPage = 1;
    renderTable();
  });

  // Export functions
  function exportExcel() {
    showLoading(true);
    setTimeout(() => {
      const fromDate = document.getElementById('fromDate').value;
      const toDate = document.getElementById('toDate').value;
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      
      const filtered = data.filter(row => {
        const dateMatch = (!fromDate || row.date >= fromDate) && (!toDate || row.date <= toDate);
        const searchMatch = Object.values(row).some(val => 
          String(val).toLowerCase().includes(searchText)
        );
        return dateMatch && searchMatch;
      });
      
      const exportData = filtered.map(row => ({
        Date: row.date,
        Item: row.item,
        Amount: formatCurrency(row.amount),
        Status: row.status
      }));
      
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(exportData);
      XLSX.utils.book_append_sheet(wb, ws, 'Reports');
      XLSX.writeFile(wb, `reports_${new Date().toISOString().slice(0,10)}.xlsx`);
      showLoading(false);
    }, 500);
  }

  async function exportPDF() {
    showLoading(true);
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Add title
      doc.setFontSize(18);
      doc.text('Reports Export', 14, 15);
      
      // Add date range if specified
      const fromDate = document.getElementById('fromDate').value;
      const toDate = document.getElementById('toDate').value;
      if (fromDate || toDate) {
        doc.setFontSize(12);
        let dateRangeText = 'All dates';
        if (fromDate && toDate) {
          dateRangeText = `From ${fromDate} to ${toDate}`;
        } else if (fromDate) {
          dateRangeText = `From ${fromDate}`;
        } else if (toDate) {
          dateRangeText = `Until ${toDate}`;
        }
        doc.text(dateRangeText, 14, 22);
      }
      
      // Add current date
      doc.setFontSize(10);
      doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 160, 10, { align: 'right' });
      
      // Add table headers
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text('Date', 14, 32);
      doc.text('Item', 50, 32);
      doc.text('Amount', 120, 32);
      doc.text('Status', 160, 32);
      
      // Add table data
      doc.setFont(undefined, 'normal');
      let y = 40;
      const filtered = data.filter(row => {
        const dateMatch = (!fromDate || row.date >= fromDate) && (!toDate || row.date <= toDate);
        const searchMatch = Object.values(row).some(val => 
          String(val).toLowerCase().includes(document.getElementById('searchInput').value.toLowerCase())
        );
        return dateMatch && searchMatch;
      });
      
      filtered.slice(0, 20).forEach(row => {
        doc.text(row.date, 14, y);
        doc.text(row.item, 50, y);
        doc.text(formatCurrency(row.amount), 120, y);
        doc.text(row.status, 160, y);
        y += 7;
      });
      
      // Add page numbers
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(10);
        doc.text(`Page ${i} of ${pageCount}`, 190, 285, { align: 'right' });
      }
      
      doc.save(`reports_${new Date().toISOString().slice(0,10)}.pdf`);
    } catch (error) {
      console.error('Error generating PDF:', error);
      alert('Failed to generate PDF. Please try again.');
    } finally {
      showLoading(false);
    }
  }

  // Report CRUD operations
  function viewReport(id) {
    const report = data.find(r => r.id === id);
    alert(`Viewing Report:\nDate: ${report.date}\nItem: ${report.item}\nAmount: ${formatCurrency(report.amount)}\nStatus: ${report.status}`);
  }

  function editReport(id) {
    const report = data.find(r => r.id === id);
    document.getElementById('report-date').value = report.date;
    document.getElementById('report-item').value = report.item;
    document.getElementById('report-amount').value = report.amount;
    document.getElementById('report-status').value = report.status;
    
    const modal = document.getElementById('add-report-modal');
    modal.classList.remove('hidden');
    
    // Store the ID we're editing
    modal.dataset.editingId = id;
  }

  function confirmDelete(id) {
    if (confirm('Are you sure you want to delete this report?')) {
      deleteReport(id);
    }
  }

  function deleteReport(id) {
    showLoading(true);
    setTimeout(() => {
      data = data.filter(r => r.id !== id);
      renderTable();
      showLoading(false);
    }, 300);
  }

  // Modal handling
  const addReportBtn = document.getElementById('add-report-btn');
  const addReportModal = document.getElementById('add-report-modal');
  const closeModalBtn = document.getElementById('close-modal');
  const cancelReportBtn = document.getElementById('cancel-report');
  const reportForm = document.getElementById('report-form');
  
  addReportBtn.addEventListener('click', () => {
    reportForm.reset();
    delete addReportModal.dataset.editingId;
    addReportModal.classList.remove('hidden');
  });
  
  closeModalBtn.addEventListener('click', () => {
    addReportModal.classList.add('hidden');
  });
  
  cancelReportBtn.addEventListener('click', () => {
    addReportModal.classList.add('hidden');
  });
  
  reportForm.addEventListener('submit', (e) => {
    e.preventDefault();
    showLoading(true);
    
    setTimeout(() => {
      const date = document.getElementById('report-date').value;
      const item = document.getElementById('report-item').value;
      const amount = parseFloat(document.getElementById('report-amount').value);
      const status = document.getElementById('report-status').value;
      
      if (addReportModal.dataset.editingId) {
        // Update existing report
        const id = parseInt(addReportModal.dataset.editingId);
        data = data.map(r => r.id === id ? { id, date, item, amount, status } : r);
      } else {
        // Add new report
        const newId = Math.max(...data.map(r => r.id)) + 1;
        data.unshift({ id: newId, date, item, amount, status });
       
</script>

    